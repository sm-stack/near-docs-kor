"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5666],{90346:(e,t,a)=>{a.d(t,{Ey:()=>d,O2:()=>u,SQ:()=>p});var n=a(67294),r=a(74866),l=a(85162),o=a(1841),s=a.n(o),i=a(95665),c=a.n(i);function u(e){var t=e.children;return Array.isArray(t)||(t=[t]),n.createElement(r.Z,{className:"language-tabs",groupId:"code-tabs"},t.map((function(e,t){return n.createElement(l.Z,{value:e.props.value,label:e.props.value},e)})))}function p(e){var t=e.children,a=e.language;return Array.isArray(t)||(t=[t]),t=t.map((function(e){return function(e,t){var a=e.props,r=a.children,l=a.url,o=a.start,i=a.end,c=a.fname;if("Github"==e.props.mdxType)return d({url:l,start:o,end:i,language:t,fname:c});if("CodeBlock"==e.props.mdxType)return n.createElement(s(),{fname:c,language:t},r);return e}(e,a)})),1==t.length?n.createElement(l.Z,{value:0,label:t[0].props.fname},t[0]):n.createElement(r.Z,{className:"file-tabs"},t.map((function(e,t){return n.createElement(l.Z,{value:t,label:e.props.fname},e)})))}function d(e){var t=e.url,a=e.start,r=e.end,l=e.language,o=e.fname,s=t+"#";return a&&r&&(s+="L"+a+"-L"+r+"#"),n.createElement(c(),{language:l,fname:o},s)}},85162:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(67294),r=a(86010);const l="tabItem_Ymn6";function o(e){var t=e.children,a=e.hidden,o=e.className;return n.createElement("div",{role:"tabpanel",className:(0,r.Z)(l,o),hidden:a},t)}},74866:(e,t,a)=>{a.d(t,{Z:()=>x});var n=a(87462),r=a(67294),l=a(86010),o=a(12466),s=a(76775),i=a(91980),c=a(67392),u=a(50012);function p(e){return function(e){return r.Children.map(e,(function(e){if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')}))}(e).map((function(e){var t=e.props;return{value:t.value,label:t.label,attributes:t.attributes,default:t.default}}))}function d(e){var t=e.values,a=e.children;return(0,r.useMemo)((function(){var e=null!=t?t:p(a);return function(e){var t=(0,c.l)(e,(function(e,t){return e.value===t.value}));if(t.length>0)throw new Error('Docusaurus error: Duplicate values "'+t.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[t,a])}function h(e){var t=e.value;return e.tabValues.some((function(e){return e.value===t}))}function m(e){var t=e.queryString,a=void 0!==t&&t,n=e.groupId,l=(0,s.k6)(),o=function(e){var t=e.queryString,a=void 0!==t&&t,n=e.groupId;if("string"==typeof a)return a;if(!1===a)return null;if(!0===a&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=n?n:null}({queryString:a,groupId:n});return[(0,i._X)(o),(0,r.useCallback)((function(e){if(o){var t=new URLSearchParams(l.location.search);t.set(o,e),l.replace(Object.assign({},l.location,{search:t.toString()}))}}),[o,l])]}function g(e){var t,a,n,l,o=e.defaultValue,s=e.queryString,i=void 0!==s&&s,c=e.groupId,p=d(e),g=(0,r.useState)((function(){return function(e){var t,a=e.defaultValue,n=e.tabValues;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(a){if(!h({value:a,tabValues:n}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+a+'" but none of its children has the corresponding value. Available values are: '+n.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return a}var r=null!=(t=n.find((function(e){return e.default})))?t:n[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:o,tabValues:p})})),k=g[0],v=g[1],b=m({queryString:i,groupId:c}),f=b[0],y=b[1],N=(t=function(e){return e?"docusaurus.tab."+e:null}({groupId:c}.groupId),a=(0,u.Nk)(t),n=a[0],l=a[1],[n,(0,r.useCallback)((function(e){t&&l.set(e)}),[t,l])]),x=N[0],C=N[1],w=function(){var e=null!=f?f:x;return h({value:e,tabValues:p})?e:null}();return(0,r.useLayoutEffect)((function(){w&&v(w)}),[w]),{selectedValue:k,selectValue:(0,r.useCallback)((function(e){if(!h({value:e,tabValues:p}))throw new Error("Can't select invalid tab value="+e);v(e),y(e),C(e)}),[y,C,p]),tabValues:p}}var k=a(72389);const v="tabList__CuJ",b="tabItem_LNqP";function f(e){var t=e.className,a=e.block,s=e.selectedValue,i=e.selectValue,c=e.tabValues,u=[],p=(0,o.o5)().blockElementScrollPositionUntilNextRender,d=function(e){var t=e.currentTarget,a=u.indexOf(t),n=c[a].value;n!==s&&(p(t),i(n))},h=function(e){var t,a=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":var n,r=u.indexOf(e.currentTarget)+1;a=null!=(n=u[r])?n:u[0];break;case"ArrowLeft":var l,o=u.indexOf(e.currentTarget)-1;a=null!=(l=u[o])?l:u[u.length-1]}null==(t=a)||t.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":a},t)},c.map((function(e){var t=e.value,a=e.label,o=e.attributes;return r.createElement("li",(0,n.Z)({role:"tab",tabIndex:s===t?0:-1,"aria-selected":s===t,key:t,ref:function(e){return u.push(e)},onKeyDown:h,onClick:d},o,{className:(0,l.Z)("tabs__item",b,null==o?void 0:o.className,{"tabs__item--active":s===t})}),null!=a?a:t)})))}function y(e){var t=e.lazy,a=e.children,n=e.selectedValue;if(a=Array.isArray(a)?a:[a],t){var l=a.find((function(e){return e.props.value===n}));return l?(0,r.cloneElement)(l,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},a.map((function(e,t){return(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==n})})))}function N(e){var t=g(e);return r.createElement("div",{className:(0,l.Z)("tabs-container",v)},r.createElement(f,(0,n.Z)({},e,t)),r.createElement(y,(0,n.Z)({},e,t)))}function x(e){var t=(0,k.Z)();return r.createElement(N,(0,n.Z)({key:String(t)},e))}},88290:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>h,contentTitle:()=>p,default:()=>k,frontMatter:()=>u,metadata:()=>d,toc:()=>m});var n=a(87462),r=a(63366),l=(a(67294),a(3905)),o=a(74866),s=a(85162),i=a(90346),c=["components"],u={id:"xcc",title:"Cross Contract Call"},p=void 0,d={unversionedId:"tutorials/examples/xcc",id:"tutorials/examples/xcc",title:"Cross Contract Call",description:"This example performs the simplest cross-contract call possible: it calls our Hello NEAR example to set and retrieve a greeting.",source:"@site/../docs/3.tutorials/examples/xcc.md",sourceDirName:"3.tutorials/examples",slug:"/tutorials/examples/xcc",permalink:"/near-docs-kor/zh-CN/tutorials/examples/xcc",draft:!1,editUrl:"https://github.com/near/docs/edit/master/website/../docs/3.tutorials/examples/xcc.md",tags:[],version:"current",lastUpdatedBy:"[sm-stack]",lastUpdatedAt:1675844989,formattedLastUpdatedAt:"2023\u5e742\u67088\u65e5",frontMatter:{id:"xcc",title:"Cross Contract Call"},sidebar:"tutorials",previous:{title:"Donation",permalink:"/near-docs-kor/zh-CN/tutorials/examples/donation"},next:{title:"Coin Flip",permalink:"/near-docs-kor/zh-CN/tutorials/examples/coin-flip"}},h={},m=[{value:"Starting with the Project",id:"starting-with-the-project",level:2},{value:"Interacting With the Contract",id:"interacting-with-the-contract",level:3},{value:"1. Build and Deploy the Contract",id:"1-build-and-deploy-the-contract",level:4},{value:"2. Get the Greeting",id:"2-get-the-greeting",level:4},{value:"Contract",id:"contract",level:3},{value:"Testing",id:"testing",level:2},{value:"Unit test",id:"unit-test",level:3},{value:"Integration test",id:"integration-test",level:3},{value:"Moving Forward",id:"moving-forward",level:2},{value:"Advanced Cross Contract Calls",id:"advanced-cross-contract-calls",level:3}],g={toc:m};function k(e){var t=e.components,a=(0,r.Z)(e,c);return(0,l.kt)("wrapper",(0,n.Z)({},g,a,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"This example performs the simplest cross-contract call possible: it calls our ",(0,l.kt)("a",{parentName:"p",href:"/near-docs-kor/zh-CN/tutorials/examples/hello-near"},"Hello NEAR")," example to set and retrieve a greeting.\nIt is one of the simplest examples on making a cross-contract call, and the perfect gateway to the world of interoperative contracts."),(0,l.kt)("admonition",{title:"Advanced Cross-Contract Calls",type:"info"},(0,l.kt)("p",{parentName:"admonition"},"Check the tutorial on how to perform cross-contract calls ",(0,l.kt)("a",{parentName:"p",href:"/near-docs-kor/zh-CN/tutorials/examples/advanced-xcc"},"in batches and in parallel"))),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"starting-with-the-project"},"Starting with the Project"),(0,l.kt)("p",null,"You have two options to start using the project. The first and recommended is to use the app through Gitpod, which will open a web-based interactive environment. The second option is to clone the repository locally, for which you will need to install all the ",(0,l.kt)("a",{parentName:"p",href:"/near-docs-kor/zh-CN/develop/prerequisites"},"Prerequisites"),"."),(0,l.kt)(o.Z,{className:"language-tabs",groupId:"code-tabs",mdxType:"Tabs"},(0,l.kt)(s.Z,{value:"\ud83c\udf10 JavaScript",mdxType:"TabItem"},(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Gitpod"),(0,l.kt)("th",{parentName:"tr",align:null},"Clone locally"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{href:"https://gitpod.io/#https://github.com/near-examples/cross-contract-hello-js"},(0,l.kt)("img",{src:"https://gitpod.io/button/open-in-gitpod.svg",alt:"Open in Gitpod"}))),(0,l.kt)("td",{parentName:"tr",align:null},"\ud83c\udf10 ",(0,l.kt)("inlineCode",{parentName:"td"},"https://github.com/near-examples/cross-contract-hello-js.git")))))),(0,l.kt)(s.Z,{value:"\ud83e\udd80 Rust",mdxType:"TabItem"},(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Gitpod"),(0,l.kt)("th",{parentName:"tr",align:null},"Clone locally"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{href:"https://gitpod.io/#https://github.com/near-examples/cross-contract-hello-rust"},(0,l.kt)("img",{src:"https://gitpod.io/button/open-in-gitpod.svg",alt:"Open in Gitpod"}))),(0,l.kt)("td",{parentName:"tr",align:null},"\ud83e\udd80 ",(0,l.kt)("inlineCode",{parentName:"td"},"https://github.com/near-examples/cross-contract-hello-rust.git")))))),(0,l.kt)(s.Z,{value:"\ud83d\ude80 AssemblyScript",mdxType:"TabItem"},(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Gitpod"),(0,l.kt)("th",{parentName:"tr",align:null},"Clone locally"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},(0,l.kt)("a",{href:"https://gitpod.io/#https://github.com/near-examples/docs-examples/blob/main/cross-contract-hello-as"},(0,l.kt)("img",{src:"https://gitpod.io/button/open-in-gitpod.svg",alt:"Open in Gitpod"}))),(0,l.kt)("td",{parentName:"tr",align:null},"\ud83d\ude80 ",(0,l.kt)("inlineCode",{parentName:"td"},"https://github.com/near-examples/docs-examples")," -> cross-contract-hello-as")))))),(0,l.kt)("hr",null),(0,l.kt)("h3",{id:"interacting-with-the-contract"},"Interacting With the Contract"),(0,l.kt)("p",null,"Since this example does not have a frontend, we will interact with it through the ",(0,l.kt)("a",{parentName:"p",href:"/near-docs-kor/zh-CN/tools/near-cli"},"NEAR CLI"),"."),(0,l.kt)("p",null,"Check the README.md. Briefly, you will need to:"),(0,l.kt)("h4",{id:"1-build-and-deploy-the-contract"},"1. Build and Deploy the Contract"),(0,l.kt)("p",null,"You can automatically compile and deploy the contract in the NEAR testnet by running:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"./deploy.sh\n")),(0,l.kt)("p",null,"Once finished, check the ",(0,l.kt)("inlineCode",{parentName:"p"},"neardev/dev-account")," file to find the address in which the contract was deployed:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"cat ./neardev/dev-account # e.g. dev-1659899566943-21539992274727\n")),(0,l.kt)("h4",{id:"2-get-the-greeting"},"2. Get the Greeting"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"query_greeting")," performs a cross-contract call, calling the ",(0,l.kt)("inlineCode",{parentName:"p"},"get_greeting()")," method from ",(0,l.kt)("inlineCode",{parentName:"p"},"hello-nearverse.testnet"),"."),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"Call")," methods can only be invoked using a NEAR account, since the account needs to pay GAS for the transaction."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"# Use near-cli to ask the contract to query the greeting\nnear call <dev-account> query_greeting --accountId <dev-account>\n")),(0,l.kt)("hr",null),(0,l.kt)("h3",{id:"contract"},"Contract"),(0,l.kt)("p",null,"The contract exposes methods to query the greeting and change it. These methods do nothing but calling ",(0,l.kt)("inlineCode",{parentName:"p"},"get_greeting")," and\n",(0,l.kt)("inlineCode",{parentName:"p"},"set_greeting")," in the ",(0,l.kt)("inlineCode",{parentName:"p"},"hello-near")," example."),(0,l.kt)(i.O2,{mdxType:"CodeTabs"},(0,l.kt)(i.SQ,{value:"\ud83c\udf10 JavaScript",language:"ts",mdxType:"Language"},(0,l.kt)(i.Ey,{fname:"contract.ts",url:"https://github.com/near-examples/cross-contract-hello-js/blob/master/contract/src/contract.ts",start:"17",end:"39",mdxType:"Github"})),(0,l.kt)(i.SQ,{value:"\ud83e\udd80 Rust",language:"rust",mdxType:"Language"},(0,l.kt)(i.Ey,{fname:"lib.rs",url:"https://github.com/near-examples/cross-contract-hello-rust/blob/main/contract/src/lib.rs",start:"24",end:"49",mdxType:"Github"})),(0,l.kt)(i.SQ,{value:"\ud83d\ude80 AssemblyScript",language:"ts",mdxType:"Language"},(0,l.kt)(i.Ey,{fname:"index.ts",url:"https://github.com/near-examples/docs-examples/blob/main/cross-contract-hello-as/contract/assembly/index.ts",start:"11",end:"45",mdxType:"Github"}))),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"testing"},"Testing"),(0,l.kt)("p",null,"When writing smart contracts it is very important to test all methods exhaustively. In this\nproject you have two types of tests: unit and integration. Before digging in them,\ngo ahead and perform the tests present in the dApp through the command ",(0,l.kt)("inlineCode",{parentName:"p"},"yarn test"),"."),(0,l.kt)("h3",{id:"unit-test"},"Unit test"),(0,l.kt)("p",null,"Unit tests check individual functions in the smart contract. They are written in the\nsame language as the smart contract is. "),(0,l.kt)("p",null,"Since this example handles Cross-contract calls, in the unit tests we only test the ",(0,l.kt)("inlineCode",{parentName:"p"},"initialize"),"\nmethod works. This is because unit tests are ",(0,l.kt)("strong",{parentName:"p"},"cannot test")," cross-contract calls."),(0,l.kt)("h3",{id:"integration-test"},"Integration test"),(0,l.kt)("p",null,"In this project in particular, the integration tests first deploy the ",(0,l.kt)("inlineCode",{parentName:"p"},"hello-near")," contract. Then,\nthey test that the cross-contract call correctly sets and retrieves the message. You will find the integration tests\nin ",(0,l.kt)("inlineCode",{parentName:"p"},"integration-tests/"),"."),(0,l.kt)(i.O2,{mdxType:"CodeTabs"},(0,l.kt)(i.SQ,{value:"\ud83c\udf10 JavaScript",language:"rust",mdxType:"Language"},(0,l.kt)(i.Ey,{fname:"main.test.js",url:"https://github.com/near-examples/cross-contract-hello-js/blob/master/integration-tests/src/main.ava.ts",start:"9",end:"59",mdxType:"Github"}))),(0,l.kt)("hr",null),(0,l.kt)("h2",{id:"moving-forward"},"Moving Forward"),(0,l.kt)("p",null,"A nice way to learn is by trying to expand a contract. Modify the cross contract example to use the ",(0,l.kt)("a",{parentName:"p",href:"/near-docs-kor/zh-CN/tutorials/examples/guest-book"},"guest-book"),"\ncontract!. In this way, you can try to make a cross-contract call that attaches money. Remember to correctly ",(0,l.kt)("a",{parentName:"p",href:"/near-docs-kor/zh-CN/develop/contracts/crosscontract#callback-method"},"handle the callback"),",\nand to return the money to the user in case of error."),(0,l.kt)("h3",{id:"advanced-cross-contract-calls"},"Advanced Cross Contract Calls"),(0,l.kt)("p",null,"Your contract can perform multiple cross-contract calls in simultaneous, creating promises that execute in parallel, or as a batch transaction. Check the ",(0,l.kt)("a",{parentName:"p",href:"/near-docs-kor/zh-CN/tutorials/examples/advanced-xcc"},"advanced cross contract calls\ntutorial")," to learn more."))}k.isMDXComponent=!0}}]);