"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9317],{3905:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>f});var o=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=o.createContext({}),c=function(e){var n=o.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},d=function(e){var n=c(e.components);return o.createElement(s.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},p=o.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),p=c(t),f=r,m=p["".concat(s,".").concat(f)]||p[f]||u[f]||a;return t?o.createElement(m,i(i({ref:n},d),{},{components:t})):o.createElement(m,i({ref:n},d))}));function f(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,i=new Array(a);i[0]=p;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var c=2;c<a;c++)i[c]=t[c];return o.createElement.apply(null,i)}return o.createElement.apply(null,t)}p.displayName="MDXCreateElement"},13596:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>f,frontMatter:()=>l,metadata:()=>c,toc:()=>u});var o=t(87462),r=t(63366),a=(t(67294),t(3905)),i=["components"],l={id:"token-loss",title:"Avoiding Token Loss",sidebar_label:"Avoiding Token Loss"},s=void 0,c={unversionedId:"integrator/errors/token-loss",id:"integrator/errors/token-loss",title:"Avoiding Token Loss",description:"Careful! Losing tokens means losing money!",source:"@site/../docs/6.integrator/errors/token-loss.md",sourceDirName:"6.integrator/errors",slug:"/integrator/errors/token-loss",permalink:"/integrator/errors/token-loss",draft:!1,editUrl:"https://github.com/near/docs/edit/master/website/../docs/6.integrator/errors/token-loss.md",tags:[],version:"current",lastUpdatedBy:"[sm-stack]",lastUpdatedAt:1675844989,formattedLastUpdatedAt:"Feb 8, 2023",frontMatter:{id:"token-loss",title:"Avoiding Token Loss",sidebar_label:"Avoiding Token Loss"},sidebar:"integrate",previous:{title:"Source Code Survey",permalink:"/integrator/errors/error-implementation"},next:{title:"Integrator FAQ",permalink:"/integrator/faq"}},d={},u=[{value:"Improper key management",id:"type-1-key-management",level:2},{value:"Loss of <code>FullAccess</code> key",id:"scenario-1a-loss-of-fullaccess-key",level:3},{value:"Loss of <code>FunctionCall</code> access key",id:"scenario-1b-loss-of-functioncall-access-key",level:3},{value:"Refunding deleted accounts",id:"type-2-refunds",level:2},{value:"Deleting account with non-existent beneficiary",id:"scenario-2a-delete-account-with-non-existent-beneficiary",level:3},{value:"Account with zero balance is garbage-collected, just before it receives refund",id:"scenario-2b-account-with-zero-balance-receives-refund",level:3},{value:"Failed function calls in batches",id:"type-3-function-calls",level:2}],p={toc:u};function f(e){var n=e.components,t=(0,r.Z)(e,i);return(0,a.kt)("wrapper",(0,o.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("admonition",{type:"warning"},(0,a.kt)("p",{parentName:"admonition"},"Careful! Losing tokens means losing money!")),(0,a.kt)("p",null,"Token loss is possible under multiple scenarios. These scenarios can be grouped into a few related classes:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Improper key management"),(0,a.kt)("li",{parentName:"ol"},"Refunding deleted accounts"),(0,a.kt)("li",{parentName:"ol"},"Failed function calls in batches")),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"type-1-key-management"},"Improper key management"),(0,a.kt)("p",null,"Improper key management may lead to token loss. Mitigating such scenarios may be done by issuing backup keys\nallowing for recovery of accounts whose keys have been lost or deleted."),(0,a.kt)("h3",{id:"scenario-1a-loss-of-fullaccess-key"},"Loss of ",(0,a.kt)("inlineCode",{parentName:"h3"},"FullAccess")," key"),(0,a.kt)("p",null,"A user may lose their private key of a ",(0,a.kt)("inlineCode",{parentName:"p"},"FullAccess")," key pair for an account with no other keys.\nNo one will be able to recover the funds. Funds will remain locked in the account forever."),(0,a.kt)("h3",{id:"scenario-1b-loss-of-functioncall-access-key"},"Loss of ",(0,a.kt)("inlineCode",{parentName:"h3"},"FunctionCall")," access key"),(0,a.kt)("p",null,"An account may have its one and only ",(0,a.kt)("inlineCode",{parentName:"p"},"FunctionCall")," access key deleted.\nNo one will be able to recover the funds. Funds will remain locked in the account forever."),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"type-2-refunds"},"Refunding deleted accounts"),(0,a.kt)("p",null,"When a refund receipt is issued for an account, if that account no longer exists, the funds will be dispersed among\nvalidators proportional to their stake in the current epoch."),(0,a.kt)("h3",{id:"scenario-2a-delete-account-with-non-existent-beneficiary"},"Deleting account with non-existent beneficiary"),(0,a.kt)("p",null,"When you delete an account, you must assign a beneficiary.\nOnce deleted, a transfer receipt is generated and sent to the beneficiary account.\nIf the beneficiary account does not exist, a refund receipt will be generated and sent back to the original account.\nSince the original account has already been deleted, the funds will be dispersed among validators."),(0,a.kt)("h3",{id:"scenario-2b-account-with-zero-balance-receives-refund"},"Account with zero balance is garbage-collected, just before it receives refund"),(0,a.kt)("p",null,"If an account ",(0,a.kt)("inlineCode",{parentName:"p"},"A")," transfers all of its funds to another account ",(0,a.kt)("inlineCode",{parentName:"p"},"B")," and account ",(0,a.kt)("inlineCode",{parentName:"p"},"B")," does not exist,\na refund receipt will be generated for account ",(0,a.kt)("inlineCode",{parentName:"p"},"A"),". During the period of this round trip,\naccount ",(0,a.kt)("inlineCode",{parentName:"p"},"A")," is vulnerable to deletion by garbage collection activities on the network.\nIf account ",(0,a.kt)("inlineCode",{parentName:"p"},"A")," is deleted before the refund receipt arrives, the funds will be dispersed among validators."),(0,a.kt)("hr",null),(0,a.kt)("h2",{id:"type-3-function-calls"},"Failed function calls in batches"),(0,a.kt)("admonition",{type:"warning"},(0,a.kt)("p",{parentName:"admonition"},"When designing a smart contract, you should always consider the asynchronous nature of NEAR Protocol.")),(0,a.kt)("p",null,"If a contract function ",(0,a.kt)("inlineCode",{parentName:"p"},"f1")," calls two (or more) other functions ",(0,a.kt)("inlineCode",{parentName:"p"},"f2")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"f3"),", and at least one of these functions, ",(0,a.kt)("inlineCode",{parentName:"p"},"f2")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"f3")," fails, then tokens will be refunded from the function that failed, but tokens will be appropriately credited to the function(s) which succeed."),(0,a.kt)("p",null,"The successful call's tokens may be considered lost depending on your use case if a single failure in the batch means the whole batch failed."))}f.isMDXComponent=!0}}]);