"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[658],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>p});var a=n(67294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var u=a.createContext({}),s=function(e){var t=a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=s(e.components);return a.createElement(u.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},k=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,r=e.originalType,u=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),k=s(n),p=l,m=k["".concat(u,".").concat(p)]||k[p]||c[p]||r;return n?a.createElement(m,o(o({ref:t},d),{},{components:n})):a.createElement(m,o({ref:t},d))}));function p(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=n.length,o=new Array(r);o[0]=k;var i={};for(var u in t)hasOwnProperty.call(t,u)&&(i[u]=t[u]);i.originalType=e,i.mdxType="string"==typeof e?e:l,o[1]=i;for(var s=2;s<r;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}k.displayName="MDXCreateElement"},85162:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(67294),l=n(86010);const r="tabItem_Ymn6";function o(e){var t=e.children,n=e.hidden,o=e.className;return a.createElement("div",{role:"tabpanel",className:(0,l.Z)(r,o),hidden:n},t)}},65488:(e,t,n)=>{n.d(t,{Z:()=>p});var a=n(87462),l=n(67294),r=n(86010),o=n(72389),i=n(67392),u=n(7094),s=n(12466);const d="tabList__CuJ",c="tabItem_LNqP";function k(e){var t,n,o=e.lazy,k=e.block,p=e.defaultValue,m=e.values,h=e.groupId,b=e.className,f=l.Children.map(e.children,(function(e){if((0,l.isValidElement)(e)&&"value"in e.props)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),g=null!=m?m:f.map((function(e){var t=e.props;return{value:t.value,label:t.label,attributes:t.attributes}})),N=(0,i.l)(g,(function(e,t){return e.value===t.value}));if(N.length>0)throw new Error('Docusaurus error: Duplicate values "'+N.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var y=null===p?p:null!=(t=null!=p?p:null==(n=f.find((function(e){return e.props.default})))?void 0:n.props.value)?t:f[0].props.value;if(null!==y&&!g.some((function(e){return e.value===y})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+y+'" but none of its children has the corresponding value. Available values are: '+g.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var v=(0,u.U)(),_=v.tabGroupChoices,R=v.setTabGroupChoices,C=(0,l.useState)(y),w=C[0],T=C[1],I=[],E=(0,s.o5)().blockElementScrollPositionUntilNextRender;if(null!=h){var V=_[h];null!=V&&V!==w&&g.some((function(e){return e.value===V}))&&T(V)}var Z=function(e){var t=e.currentTarget,n=I.indexOf(t),a=g[n].value;a!==w&&(E(t),T(a),null!=h&&R(h,String(a)))},O=function(e){var t,n=null;switch(e.key){case"ArrowRight":var a,l=I.indexOf(e.currentTarget)+1;n=null!=(a=I[l])?a:I[0];break;case"ArrowLeft":var r,o=I.indexOf(e.currentTarget)-1;n=null!=(r=I[o])?r:I[I.length-1]}null==(t=n)||t.focus()};return l.createElement("div",{className:(0,r.Z)("tabs-container",d)},l.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":k},b)},g.map((function(e){var t=e.value,n=e.label,o=e.attributes;return l.createElement("li",(0,a.Z)({role:"tab",tabIndex:w===t?0:-1,"aria-selected":w===t,key:t,ref:function(e){return I.push(e)},onKeyDown:O,onFocus:Z,onClick:Z},o,{className:(0,r.Z)("tabs__item",c,null==o?void 0:o.className,{"tabs__item--active":w===t})}),null!=n?n:t)}))),o?(0,l.cloneElement)(f.filter((function(e){return e.props.value===w}))[0],{className:"margin-top--md"}):l.createElement("div",{className:"margin-top--md"},f.map((function(e,t){return(0,l.cloneElement)(e,{key:t,hidden:e.props.value!==w})}))))}function p(e){var t=(0,o.Z)();return l.createElement(k,(0,a.Z)({key:String(t)},e))}},61086:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>k,contentTitle:()=>d,default:()=>h,frontMatter:()=>s,metadata:()=>c,toc:()=>p});var a=n(87462),l=n(63366),r=(n(67294),n(3905)),o=n(65488),i=n(85162),u=["components"],s={id:"contracts",title:"Accounts / Contracts"},d=void 0,c={unversionedId:"api/rpc/contracts",id:"api/rpc/contracts",title:"Accounts / Contracts",description:"",source:"@site/../docs/5.api/rpc/contracts.md",sourceDirName:"5.api/rpc",slug:"/api/rpc/contracts",permalink:"/api/rpc/contracts",draft:!1,editUrl:"https://github.com/near/docs/edit/master/website/../docs/5.api/rpc/contracts.md",tags:[],version:"current",lastUpdatedBy:"[sm-stack]",lastUpdatedAt:1675844989,formattedLastUpdatedAt:"Feb 8, 2023",frontMatter:{id:"contracts",title:"Accounts / Contracts"},sidebar:"api",previous:{title:"Access Keys",permalink:"/api/rpc/access-keys"},next:{title:"Block / Chunk",permalink:"/api/rpc/block-chunk"}},k={},p=[{value:"View account",id:"view-account",level:2},{value:"What Could Go Wrong?",id:"what-could-go-wrong",level:4},{value:"View account changes",id:"view-account-changes",level:2},{value:"What Could Go Wrong?",id:"what-could-go-wrong-1",level:4},{value:"View contract code",id:"view-contract-code",level:2},{value:"What Could Go Wrong?",id:"what-could-go-wrong-2",level:4},{value:"View contract state",id:"view-contract-state",level:2},{value:"What Could Go Wrong?",id:"what-could-go-wrong-3",level:4},{value:"View contract state changes",id:"view-contract-state-changes",level:2},{value:"What Could Go Wrong?",id:"what-could-go-wrong-4",level:4},{value:"View contract code changes",id:"view-contract-code-changes",level:2},{value:"What Could Go Wrong?",id:"what-could-go-wrong-5",level:4},{value:"Call a contract function",id:"call-a-contract-function",level:2},{value:"What Could Go Wrong?",id:"what-could-go-wrong-6",level:4}],m={toc:p};function h(e){var t=e.components,n=(0,l.Z)(e,u);return(0,r.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"The RPC API enables you to view details about accounts and contracts as well as perform contract calls."),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"view-account"},"View account"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Returns basic account information.")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"method: ",(0,r.kt)("inlineCode",{parentName:"li"},"query")),(0,r.kt)("li",{parentName:"ul"},"params:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"request_type"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"view_account")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/api/rpc/setup#using-finality-param"},(0,r.kt)("inlineCode",{parentName:"a"},"finality"))," ",(0,r.kt)("em",{parentName:"li"},"OR")," ",(0,r.kt)("a",{parentName:"li",href:"/api/rpc/setup#using-block_id-param"},(0,r.kt)("inlineCode",{parentName:"a"},"block_id"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"account_id"),": ",(0,r.kt)("em",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"em"},'"example.testnet"')))))),(0,r.kt)("p",null,"Example:"),(0,r.kt)(o.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"json",label:"JSON",default:!0,mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jsonrpc": "2.0",\n  "id": "dontcare",\n  "method": "query",\n  "params": {\n    "request_type": "view_account",\n    "finality": "final",\n    "account_id": "nearkat.testnet"\n  }\n}\n'))),(0,r.kt)(i.Z,{value:"\ud83c\udf10 JavaScript",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const response = await near.connection.provider.query({\n  request_type: "view_account",\n  finality: "final",\n  account_id: "nearkat.testnet",\n});\n'))),(0,r.kt)(i.Z,{value:"http",label:"HTTPie",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'http post https://rpc.testnet.near.org jsonrpc=2.0 id=dontcare method=query \\\n  params:=\'{\n    "request_type": "view_account",\n    "finality": "final",\n    "account_id": "nearkat.testnet"\n  }\'\n')))),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Example response: "),(0,r.kt)("p",null,(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jsonrpc": "2.0",\n  "result": {\n    "amount": "399992611103597728750000000",\n    "locked": "0",\n    "code_hash": "11111111111111111111111111111111",\n    "storage_usage": 642,\n    "storage_paid_at": 0,\n    "block_height": 17795474,\n    "block_hash": "9MjpcnwW3TSdzGweNfPbkx8M74q1XzUcT1PAN8G5bNDz"\n  },\n  "id": "dontcare"\n}\n')))),(0,r.kt)("h4",{id:"what-could-go-wrong"},"What Could Go Wrong?"),(0,r.kt)("p",null,"When API request fails, RPC server returns a structured error response with a limited number of well-defined error variants, so client code can exhaustively handle all the possible error cases. Our JSON-RPC errors follow ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/joyent/node-verror"},"verror")," convention for structuring the error response:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "error": {\n        "name": <ERROR_TYPE>,\n        "cause": {\n            "info": {..},\n            "name": <ERROR_CAUSE>\n        },\n        "code": -32000,\n        "data": String,\n        "message": "Server error",\n    },\n    "id": "dontcare",\n    "jsonrpc": "2.0"\n}\n')),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Heads up")),(0,r.kt)("p",{parentName:"blockquote"},"The fields ",(0,r.kt)("inlineCode",{parentName:"p"},"code"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"data"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"message")," in the structure above are considered legacy ones and might be deprecated in the future. Please, don't rely on them.")),(0,r.kt)("p",null,"Here is the exhaustive list of the error variants that can be returned by ",(0,r.kt)("inlineCode",{parentName:"p"},"view_account")," request type:"),(0,r.kt)("table",{class:"custom-stripe"},(0,r.kt)("thead",null,(0,r.kt)("tr",null,(0,r.kt)("th",null,"ERROR_TYPE",(0,r.kt)("br",null),(0,r.kt)("code",null,"error.name")),(0,r.kt)("th",null,"ERROR_CAUSE",(0,r.kt)("br",null),(0,r.kt)("code",null,"error.cause.name")),(0,r.kt)("th",null,"Reason"),(0,r.kt)("th",null,"Solution"))),(0,r.kt)("tbody",null,(0,r.kt)("tr",null,(0,r.kt)("td",{rowspan:"5"},"HANDLER_ERROR"),(0,r.kt)("td",null,"UNKNOWN_BLOCK"),(0,r.kt)("td",null,"The requested block has not been produced yet or it has been garbage-collected (cleaned up to save space on the RPC node)"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Check that the requested block is legit"),(0,r.kt)("li",null,"If the block had been produced more than 5 epochs ago, try to send your request to ",(0,r.kt)("a",{href:"https://near-nodes.io/intro/node-types#archival-node"},"an archival node"))))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"INVALID_ACCOUNT"),(0,r.kt)("td",null,"The requested ",(0,r.kt)("code",null,"account_id")," is invalid"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Provide a valid ",(0,r.kt)("code",null,"account_id"))))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"UNKNOWN_ACCOUNT"),(0,r.kt)("td",null,"The requested ",(0,r.kt)("code",null,"account_id")," has not been found while viewing since the account has not been created or has been already deleted"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Check the ",(0,r.kt)("code",null,"account_id")),(0,r.kt)("li",null,"Specify a different block or retry if you request the latest state")))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"UNAVAILABLE_SHARD"),(0,r.kt)("td",null,"The node was unable to find the requested data because it does not track the shard where data is present"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Send a request to a different node which might track the shard")))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"NO_SYNCED_BLOCKS"),(0,r.kt)("td",null,"The node is still syncing and the requested block is not in the database yet"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Wait until the node finish syncing"),(0,r.kt)("li",null,"Send a request to a different node which is synced")))),(0,r.kt)("tr",{class:"stripe"},(0,r.kt)("td",null,"REQUEST_VALIDATION_ERROR"),(0,r.kt)("td",null,"PARSE_ERROR"),(0,r.kt)("td",null,"Passed arguments can't be parsed by JSON RPC server (missing arguments, wrong format, etc.)"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Check the arguments passed and pass the correct ones"),(0,r.kt)("li",null,"Check ",(0,r.kt)("code",null,"error.cause.info")," for more details")))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"INTERNAL_ERROR"),(0,r.kt)("td",null,"INTERNAL_ERROR"),(0,r.kt)("td",null,"Something went wrong with the node itself or overloaded"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Try again later"),(0,r.kt)("li",null,"Send a request to a different node"),(0,r.kt)("li",null,"Check ",(0,r.kt)("code",null,"error.cause.info")," for more details")))))),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"view-account-changes"},"View account changes"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Returns account changes from transactions in a given account.")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"method: ",(0,r.kt)("inlineCode",{parentName:"li"},"EXPERIMENTAL_changes")),(0,r.kt)("li",{parentName:"ul"},"params:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"changes_type"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"account_changes")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"account_ids"),": ","[",(0,r.kt)("inlineCode",{parentName:"li"},'"example.testnet"'),"]"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/api/rpc/setup#using-finality-param"},(0,r.kt)("inlineCode",{parentName:"a"},"finality"))," ",(0,r.kt)("em",{parentName:"li"},"OR")," ",(0,r.kt)("a",{parentName:"li",href:"/api/rpc/setup#using-block_id-param"},(0,r.kt)("inlineCode",{parentName:"a"},"block_id")))))),(0,r.kt)("p",null,"Example:"),(0,r.kt)(o.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"json",label:"JSON",default:!0,mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jsonrpc": "2.0",\n  "id": "dontcare",\n  "method": "EXPERIMENTAL_changes",\n  "params": {\n    "changes_type": "account_changes",\n    "account_ids": ["your_account.testnet"],\n    "block_id": 19703467\n  }\n}\n'))),(0,r.kt)(i.Z,{value:"\ud83c\udf10 JavaScript",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const response = await near.connection.provider.experimental_changes({\n  changes_type: "account_changes",\n  account_ids: ["nearkat.testnet"],\n  block_id: 19703467,\n});\n'))),(0,r.kt)(i.Z,{value:"http",label:"HTTPie",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'http post https://rpc.testnet.near.org jsonrpc=2.0 id=dontcare method=EXPERIMENTAL_changes \\\n  params:=\'{\n    "changes_type": "account_changes",\n    "account_ids": ["your_account.testnet"],\n    "block_id": 19703467\n  }\'\n')))),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Example response: "),(0,r.kt)("p",null,(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jsonrpc": "2.0",\n  "result": {\n    "block_hash": "6xsfPSG89s6fCMShxxxQTP6D4ZHM9xkGCgubayTDRzAP",\n    "changes": [\n      {\n        "cause": {\n          "type": "transaction_processing",\n          "tx_hash": "HLvxLKFM7gohFSqXPp5SpyydNEVpAno352qJJbnddsz3"\n        },\n        "type": "account_update",\n        "change": {\n          "account_id": "your_account.testnet",\n          "amount": "499999959035075000000000000",\n          "locked": "0",\n          "code_hash": "11111111111111111111111111111111",\n          "storage_usage": 182,\n          "storage_paid_at": 0\n        }\n      },\n      {\n        "cause": {\n          "type": "receipt_processing",\n          "receipt_hash": "CPenN1dp4DNKnb9LiL5hkPmu1WiKLMuM7msDjEZwDmwa"\n        },\n        "type": "account_update",\n        "change": {\n          "account_id": "your_account.testnet",\n          "amount": "499999959035075000000000000",\n          "locked": "0",\n          "code_hash": "11111111111111111111111111111111",\n          "storage_usage": 264,\n          "storage_paid_at": 0\n        }\n      }\n    ]\n  },\n  "id": "dontcare"\n}\n')))),(0,r.kt)("h4",{id:"what-could-go-wrong-1"},"What Could Go Wrong?"),(0,r.kt)("p",null,"When API request fails, RPC server returns a structured error response with a limited number of well-defined error variants, so client code can exhaustively handle all the possible error cases. Our JSON-RPC errors follow ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/joyent/node-verror"},"verror")," convention for structuring the error response:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "error": {\n        "name": <ERROR_TYPE>,\n        "cause": {\n            "info": {..},\n            "name": <ERROR_CAUSE>\n        },\n        "code": -32000,\n        "data": String,\n        "message": "Server error",\n    },\n    "id": "dontcare",\n    "jsonrpc": "2.0"\n}\n')),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Heads up")),(0,r.kt)("p",{parentName:"blockquote"},"The fields ",(0,r.kt)("inlineCode",{parentName:"p"},"code"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"data"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"message")," in the structure above are considered legacy ones and might be deprecated in the future. Please, don't rely on them.")),(0,r.kt)("p",null,"Here is the exhaustive list of the error variants that can be returned by ",(0,r.kt)("inlineCode",{parentName:"p"},"EXPERIMENTAL_changes")," method:"),(0,r.kt)("table",{class:"custom-stripe"},(0,r.kt)("thead",null,(0,r.kt)("tr",null,(0,r.kt)("th",null,"ERROR_TYPE",(0,r.kt)("br",null),(0,r.kt)("code",null,"error.name")),(0,r.kt)("th",null,"ERROR_CAUSE",(0,r.kt)("br",null),(0,r.kt)("code",null,"error.cause.name")),(0,r.kt)("th",null,"Reason"),(0,r.kt)("th",null,"Solution"))),(0,r.kt)("tbody",null,(0,r.kt)("tr",null,(0,r.kt)("td",{rowspan:"2"},"HANDLER_ERROR"),(0,r.kt)("td",null,"UNKNOWN_BLOCK"),(0,r.kt)("td",null,"The requested block has not been produced yet or it has been garbage-collected (cleaned up to save space on the RPC node)"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Check that the requested block is legit"),(0,r.kt)("li",null,"If the block had been produced more than 5 epochs ago, try to send your request to ",(0,r.kt)("a",{href:"https://near-nodes.io/intro/node-types#archival-node"},"an archival node"))))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"NOT_SYNCED_YET"),(0,r.kt)("td",null,"The node is still syncing and the requested block is not in the database yet"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Wait until the node finish syncing"),(0,r.kt)("li",null,"Send a request to a different node which is synced")))),(0,r.kt)("tr",{class:"stripe"},(0,r.kt)("td",null,"REQUEST_VALIDATION_ERROR"),(0,r.kt)("td",null,"PARSE_ERROR"),(0,r.kt)("td",null,"Passed arguments can't be parsed by JSON RPC server (missing arguments, wrong format, etc.)"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Check the arguments passed and pass the correct ones"),(0,r.kt)("li",null,"Check ",(0,r.kt)("code",null,"error.cause.info")," for more details")))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"INTERNAL_ERROR"),(0,r.kt)("td",null,"INTERNAL_ERROR"),(0,r.kt)("td",null,"Something went wrong with the node itself or overloaded"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Try again later"),(0,r.kt)("li",null,"Send a request to a different node"),(0,r.kt)("li",null,"Check ",(0,r.kt)("code",null,"error.cause.info")," for more details")))))),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"view-contract-code"},"View contract code"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Returns the contract code (Wasm binary) deployed to the account. Please note that the returned code will be encoded in base64.")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"method: ",(0,r.kt)("inlineCode",{parentName:"li"},"query")),(0,r.kt)("li",{parentName:"ul"},"params:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"request_type"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"view_code")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/api/rpc/setup#using-finality-param"},(0,r.kt)("inlineCode",{parentName:"a"},"finality"))," ",(0,r.kt)("em",{parentName:"li"},"OR")," ",(0,r.kt)("a",{parentName:"li",href:"/api/rpc/setup#using-block_id-param"},(0,r.kt)("inlineCode",{parentName:"a"},"block_id"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"account_id"),": ",(0,r.kt)("inlineCode",{parentName:"li"},'"guest-book.testnet"'),",")))),(0,r.kt)("p",null,"Example:"),(0,r.kt)(o.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"json",label:"JSON",default:!0,mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jsonrpc": "2.0",\n  "id": "dontcare",\n  "method": "query",\n  "params": {\n    "request_type": "view_code",\n    "finality": "final",\n    "account_id": "guest-book.testnet"\n  }\n}\n'))),(0,r.kt)(i.Z,{value:"\ud83c\udf10 JavaScript",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const response = await near.connection.provider.query({\n  request_type: "view_code",\n  finality: "final",\n  account_id: "guest-book.testnet",\n});\n'))),(0,r.kt)(i.Z,{value:"http",label:"HTTPie",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'http post https://rpc.testnet.near.org jsonrpc=2.0 id=dontcare method=query \\\n  params:=\'{\n    "request_type": "view_code",\n    "finality": "final",\n    "account_id": "guest-book.testnet"\n  }\'\n')))),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Example response: "),(0,r.kt)("p",null,(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jsonrpc": "2.0",\n  "result": {\n    "code_base64": "47DEQpj8HBSa+/TImW+5JCeuQeRkm5NMpJWZG3hSuFU=",\n    "hash": "7KoFshMQkdyo5iTx8P2LbLu9jQpxRn24d27FrKShNVXs",\n    "block_height": 17814234,\n    "block_hash": "GT1D8nweVQU1zyCUv399x8vDv2ogVq71w17MyR66hXBB"\n  },\n  "id": "dontcare"\n}\n')))),(0,r.kt)("h4",{id:"what-could-go-wrong-2"},"What Could Go Wrong?"),(0,r.kt)("p",null,"When API request fails, RPC server returns a structured error response with a limited number of well-defined error variants, so client code can exhaustively handle all the possible error cases. Our JSON-RPC errors follow ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/joyent/node-verror"},"verror")," convention for structuring the error response:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "error": {\n        "name": <ERROR_TYPE>,\n        "cause": {\n            "info": {..},\n            "name": <ERROR_CAUSE>\n        },\n        "code": -32000,\n        "data": String,\n        "message": "Server error",\n    },\n    "id": "dontcare",\n    "jsonrpc": "2.0"\n}\n')),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Heads up")),(0,r.kt)("p",{parentName:"blockquote"},"The fields ",(0,r.kt)("inlineCode",{parentName:"p"},"code"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"data"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"message")," in the structure above are considered legacy ones and might be deprecated in the future. Please, don't rely on them.")),(0,r.kt)("p",null,"Here is the exhaustive list of the error variants that can be returned by ",(0,r.kt)("inlineCode",{parentName:"p"},"view_code")," request type:"),(0,r.kt)("table",{class:"custom-stripe"},(0,r.kt)("thead",null,(0,r.kt)("tr",null,(0,r.kt)("th",null,"ERROR_TYPE",(0,r.kt)("br",null),(0,r.kt)("code",null,"error.name")),(0,r.kt)("th",null,"ERROR_CAUSE",(0,r.kt)("br",null),(0,r.kt)("code",null,"error.cause.name")),(0,r.kt)("th",null,"Reason"),(0,r.kt)("th",null,"Solution"))),(0,r.kt)("tbody",null,(0,r.kt)("tr",null,(0,r.kt)("td",{rowspan:"6"},"HANDLER_ERROR"),(0,r.kt)("td",null,"UNKNOWN_BLOCK"),(0,r.kt)("td",null,"The requested block has not been produced yet or it has been garbage-collected (cleaned up to save space on the RPC node)"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Check that the requested block is legit"),(0,r.kt)("li",null,"If the block had been produced more than 5 epochs ago, try to send your request to ",(0,r.kt)("a",{href:"https://near-nodes.io/intro/node-types#archival-node"},"an archival node"))))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"INVALID_ACCOUNT"),(0,r.kt)("td",null,"The requested ",(0,r.kt)("code",null,"account_id")," is invalid"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Provide a valid ",(0,r.kt)("code",null,"account_id"))))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"UNKNOWN_ACCOUNT"),(0,r.kt)("td",null,"The requested ",(0,r.kt)("code",null,"account_id")," has not been found while viewing since the account has not been created or has been already deleted"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Check the ",(0,r.kt)("code",null,"account_id")),(0,r.kt)("li",null,"Specify a different block or retry if you request the latest state")))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"NO_CONTRACT_CODE"),(0,r.kt)("td",null,"The account does not have any ",(0,r.kt)("code",null,"contract")," deployed on it"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Use different account"),(0,r.kt)("li",null,"Specify a different block or retry if you request the latest state")))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"UNAVAILABLE_SHARD"),(0,r.kt)("td",null,"The node was unable to find the requested data because it does not track the shard where data is present"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Send a request to a different node which might track the shard")))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"NO_SYNCED_BLOCKS"),(0,r.kt)("td",null,"The node is still syncing and the requested block is not in the database yet"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Wait until the node finish syncing"),(0,r.kt)("li",null,"Send a request to a different node which is synced")))),(0,r.kt)("tr",{class:"stripe"},(0,r.kt)("td",null,"REQUEST_VALIDATION_ERROR"),(0,r.kt)("td",null,"PARSE_ERROR"),(0,r.kt)("td",null,"Passed arguments can't be parsed by JSON RPC server (missing arguments, wrong format, etc.)"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Check the arguments passed and pass the correct ones"),(0,r.kt)("li",null,"Check ",(0,r.kt)("code",null,"error.cause.info")," for more details")))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"INTERNAL_ERROR"),(0,r.kt)("td",null,"INTERNAL_ERROR"),(0,r.kt)("td",null,"Something went wrong with the node itself or overloaded"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Try again later"),(0,r.kt)("li",null,"Send a request to a different node"),(0,r.kt)("li",null,"Check ",(0,r.kt)("code",null,"error.cause.info")," for more details")))))),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"view-contract-state"},"View contract state"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Returns the state (key value pairs) of a contract based on the key prefix (base64 encoded). Pass an empty string for ",(0,r.kt)("inlineCode",{parentName:"p"},"prefix_base64")," if you would like to return the entire state. Please note that the returned state will be base64 encoded as well.")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"method: ",(0,r.kt)("inlineCode",{parentName:"li"},"query")),(0,r.kt)("li",{parentName:"ul"},"params:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"request_type"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"view_state")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/api/rpc/setup#using-finality-param"},(0,r.kt)("inlineCode",{parentName:"a"},"finality"))," ",(0,r.kt)("em",{parentName:"li"},"OR")," ",(0,r.kt)("a",{parentName:"li",href:"/api/rpc/setup#using-block_id-param"},(0,r.kt)("inlineCode",{parentName:"a"},"block_id"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"account_id"),": ",(0,r.kt)("inlineCode",{parentName:"li"},'"guest-book.testnet"'),","),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"prefix_base64"),": ",(0,r.kt)("inlineCode",{parentName:"li"},'""'))))),(0,r.kt)("p",null,"Example:"),(0,r.kt)(o.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"json",label:"JSON",default:!0,mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jsonrpc": "2.0",\n  "id": "dontcare",\n  "method": "query",\n  "params": {\n    "request_type": "view_state",\n    "finality": "final",\n    "account_id": "guest-book.testnet",\n    "prefix_base64": ""\n  }\n}\n'))),(0,r.kt)(i.Z,{value:"\ud83c\udf10 JavaScript",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const response = await near.connection.provider.query({\n  request_type: "view_state",\n  finality: "final",\n  account_id: "guest-book.testnet",\n  prefix_base64: "",\n});\n'))),(0,r.kt)(i.Z,{value:"http",label:"HTTPie",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'http post https://rpc.testnet.near.org jsonrpc=2.0 id=dontcare method=query \\\n  params:=\'{\n    "request_type": "view_state",\n    "finality": "final",\n    "account_id": "guest-book.testnet",\n    "prefix_base64": ""\n  }\'\n')))),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Example response: "),(0,r.kt)("p",null,(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jsonrpc": "2.0",\n  "result": {\n    "values": [\n      {\n        "key": "bTo6MA==",\n        "value": "eyJwcmVtaXVtIjp0cnVlLCJzZW5kZXIiOiJqb3NoZm9yZC50ZXN0bmV0IiwidGV4dCI6ImhlbGxvIn0=",\n        "proof": []\n      },\n      {\n        "key": "bTo6MQ==",\n        "value": "eyJwcmVtaXVtIjpmYWxzZSwic2VuZGVyIjoiY2hhZG9oIiwidGV4dCI6ImhlbGxvIGVyeWJvZHkifQ==",\n        "proof": []\n      },\n      {\n        "key": "bTo6MTA=",\n        "value": "eyJwcmVtaXVtIjpmYWxzZSwic2VuZGVyIjoic2F0b3NoaWYudGVzdG5ldCIsInRleHQiOiJIaWxsbyEifQ==",\n        "proof": []\n      },\n      {\n        "key": "bTo6MTE=",\n        "value": "eyJwcmVtaXVtIjpmYWxzZSwic2VuZGVyIjoidmFsZW50aW5lc29rb2wudGVzdG5ldCIsInRleHQiOiJIaSEifQ==",\n        "proof": []\n      },\n      {\n        "key": "bTo6MTI=",\n        "value": "eyJwcmVtaXVtIjp0cnVlLCJzZW5kZXIiOiJobngudGVzdG5ldCIsInRleHQiOiJoZWxsbyJ9",\n        "proof": []\n      },\n      {\n        "key": "bTo6MTM=",\n        "value": "eyJwcmVtaXVtIjp0cnVlLCJzZW5kZXIiOiJobngudGVzdG5ldCIsInRleHQiOiJzZCJ9",\n        "proof": []\n      },\n      {\n        "key": "bTo6MTQ=",\n        "value": "eyJwcmVtaXVtIjpmYWxzZSwic2VuZGVyIjoiamdoZy50ZXN0bmV0IiwidGV4dCI6IktoZyJ9",\n        "proof": []\n      },\n      {\n        "key": "bTo6MTU=",\n        "value": "eyJwcmVtaXVtIjpmYWxzZSwic2VuZGVyIjoiYWNjb3VudC50ZXN0bmV0IiwidGV4dCI6IldoZW4gSUNPPyJ9",\n        "proof": []\n      },\n      {\n        "key": "bTo6MTY=",\n        "value": "eyJwcmVtaXVtIjpmYWxzZSwic2VuZGVyIjoiYWNjb3VudC50ZXN0bmV0IiwidGV4dCI6IlRlc3QgMiJ9",\n        "proof": []\n      },\n      {\n        "key": "bTo6MTc=",\n        "value": "eyJwcmVtaXVtIjpmYWxzZSwic2VuZGVyIjoidGVzdC1kcm9wLTEwLnRlc3RuZXQiLCJ0ZXh0IjoiRnJlZSBtZXNzYWdlcyBhcmUgdGhlIGJlc3QifQ==",\n        "proof": []\n      },\n      {\n        "key": "bTo6MTg=",\n        "value": "eyJwcmVtaXVtIjpmYWxzZSwic2VuZGVyIjoidGVzdC1kcm9wLTEwLnRlc3RuZXQiLCJ0ZXh0IjoiV2hlbiBJQ08/In0=",\n        "proof": []\n      },\n      {\n        "key": "bTo6MTk=",\n        "value": "eyJwcmVtaXVtIjpmYWxzZSwic2VuZGVyIjoidGVzdC1kcm9wLTEwLnRlc3RuZXQiLCJ0ZXh0IjoiV2hlbiBJQ08/In0=",\n        "proof": []\n      },\n      {\n        "key": "bTo6Mg==",\n        "value": "eyJwcmVtaXVtIjpmYWxzZSwic2VuZGVyIjoibnVsbCIsInRleHQiOiJ1bmRlZmluZWQifQ==",\n        "proof": []\n      },\n      {\n        "key": "bTo6MjA=",\n        "value": "eyJwcmVtaXVtIjpmYWxzZSwic2VuZGVyIjoidGVzdC04NDEudGVzdG5ldCIsInRleHQiOiJXaGVuIElDTz8ifQ==",\n        "proof": []\n      },\n      {\n        "key": "bTo6MjE=",\n        "value": "eyJwcmVtaXVtIjpmYWxzZSwic2VuZGVyIjoidGVzdC04NDEudGVzdG5ldCIsInRleHQiOiJoZXkgaGV5IGhleSJ9",\n        "proof": []\n      },\n      {\n        "key": "bTo6MjI=",\n        "value": "eyJwcmVtaXVtIjpmYWxzZSwic2VuZGVyIjoiam9zaGZvcmQudGVzdG5ldCIsInRleHQiOiJoaSJ9",\n        "proof": []\n      },\n      {\n        "key": "bTo6MjM=",\n        "value": "eyJwcmVtaXVtIjpmYWxzZSwic2VuZGVyIjoiam9zaGZvcmQudGVzdG5ldCIsInRleHQiOiJoaSB4MiJ9",\n        "proof": []\n      },\n      {\n        "key": "bTo6MjQ=",\n        "value": "eyJwcmVtaXVtIjpmYWxzZSwic2VuZGVyIjoibWFzdGVydGh5c2VsZi50ZXN0bmV0IiwidGV4dCI6ImhhbmRzaGFrZS5oYWNrbWVkb21haW4vICJ9",\n        "proof": []\n      },\n      {\n        "key": "bTo6MjU=",\n        "value": "eyJwcmVtaXVtIjp0cnVlLCJzZW5kZXIiOiJtYXN0ZXJ0aHlzZWxmLnRlc3RuZXQiLCJ0ZXh0IjoiSGVsbG8gQ29zbW9zLCBob21lLmNvc21hdHJpeGNvbm5lY3Rpb25zLyJ9",\n        "proof": []\n      },\n      {\n        "key": "bTo6MjY=",\n        "value": "eyJwcmVtaXVtIjp0cnVlLCJzZW5kZXIiOiJtYXN0ZXJ0aHlzZWxmLnRlc3RuZXQiLCJ0ZXh0IjoiYnVpbGQsIGJ1aWxkLCBidWlsZCBpIGNhbWUgdG8gYnVpbGQgYSBicmlkZ2UgaW4gUEVBQ0UsIHNvIGNvbWUgbGV0cyBidWlsZC4uLnNvbmcgYnkgXCJOYWhrbyBCZWFyXCIgIn0=",\n        "proof": []\n      },\n      {\n        "key": "bTo6Mjc=",\n        "value": "eyJwcmVtaXVtIjp0cnVlLCJzZW5kZXIiOiJtYXN0ZXJ0aHlzZWxmLnRlc3RuZXQiLCJ0ZXh0IjoiYnVpbGQgYSBicmlkZ2UgKGh0dHBzOi8vd3d3Lmdvb2dsZS5jb20vdXJsP3NhPXQmcmN0PWomcT0mZXNyYz1zJnNvdXJjZT13ZWImY2Q9JmNhZD1yamEmdWFjdD04JnZlZD0yYWhVS0V3ajA0ZGlnMTlqckFoV05tbGtLSGR5X0FnUVEzeXd3QUhvRUNBVVFBZyZ1cmw9aHR0cHMlM0ElMkYlMkZ3d3cueW91dHViZS5jb20lMkZ3YXRjaCUzRnYlM0Rlb1RYNWZmOVplMCZ1c2c9QU92VmF3MFoxZzFIMkZzeF85d3FJSmg5RTk2UCkifQ==",\n        "proof": []\n      },\n      {\n        "key": "bTo6Mjg=",\n        "value": "eyJwcmVtaXVtIjp0cnVlLCJzZW5kZXIiOiJtYXN0ZXJ0aHlzZWxmLnRlc3RuZXQiLCJ0ZXh0IjoiaHR0cDovL3RyaXBweS7wn42EbWFnaWMvIn0=",\n        "proof": []\n      },\n      {\n        "key": "bTo6Mjk=",\n        "value": "eyJwcmVtaXVtIjp0cnVlLCJzZW5kZXIiOiJtYXN0ZXJ0aHlzZWxmLnRlc3RuZXQiLCJ0ZXh0IjoiaHR0cDovL3VuaXRlLnJhaW5ib3d0cmliZXMvIn0=",\n        "proof": []\n      },\n      {\n        "key": "bTo6Mw==",\n        "value": "eyJwcmVtaXVtIjpmYWxzZSwic2VuZGVyIjoiam9zaGZvcmQudGVzdG5ldCIsInRleHQiOiJobW1tbW1tIn0=",\n        "proof": []\n      },\n      {\n        "key": "bTo6MzA=",\n        "value": "eyJwcmVtaXVtIjpmYWxzZSwic2VuZGVyIjoiZXhlbXBsYXJ5LnRlc3RuZXQiLCJ0ZXh0IjoiaGVsbG8ifQ==",\n        "proof": []\n      },\n      {\n        "key": "bTo6MzE=",\n        "value": "eyJwcmVtaXVtIjpmYWxzZSwic2VuZGVyIjoiYWRpMjMudGVzdG5ldCIsInRleHQiOiJobW0ifQ==",\n        "proof": []\n      },\n      {\n        "key": "bTo6MzI=",\n        "value": "eyJwcmVtaXVtIjpmYWxzZSwic2VuZGVyIjoiYWRpMjMudGVzdG5ldCIsInRleHQiOiJ3aGF0In0=",\n        "proof": []\n      },\n      {\n        "key": "bTo6MzM=",\n        "value": "eyJwcmVtaXVtIjpmYWxzZSwic2VuZGVyIjoidmxhZGJhc2gudGVzdG5ldCIsInRleHQiOiJIaSJ9",\n        "proof": []\n      },\n      {\n        "key": "bTo6NA==",\n        "value": "eyJwcmVtaXVtIjpmYWxzZSwic2VuZGVyIjoibnVsbCIsInRleHQiOiIgIn0=",\n        "proof": []\n      },\n      {\n        "key": "bTo6NQ==",\n        "value": "eyJwcmVtaXVtIjp0cnVlLCJzZW5kZXIiOiJ0ZXN0YWNjb3VudDEudGVzdG5ldCIsInRleHQiOiJ0ZXN0In0=",\n        "proof": []\n      },\n      {\n        "key": "bTo6Ng==",\n        "value": "eyJwcmVtaXVtIjpmYWxzZSwic2VuZGVyIjoiZXVnZW5ldGhlZHJlYW0iLCJ0ZXh0IjoibnVsbCJ9",\n        "proof": []\n      },\n      {\n        "key": "bTo6Nw==",\n        "value": "eyJwcmVtaXVtIjpmYWxzZSwic2VuZGVyIjoiZGVtby50ZXN0bmV0IiwidGV4dCI6Ikkgb25seSB3cml0ZSBmcmVlIG1lc3NhZ2VzLiJ9",\n        "proof": []\n      },\n      {\n        "key": "bTo6OA==",\n        "value": "eyJwcmVtaXVtIjp0cnVlLCJzZW5kZXIiOiJqb3NoZm9yZC50ZXN0bmV0IiwidGV4dCI6IkkgcHJlZmVyIHByZW1pdW0gbWVzc2FnZXMifQ==",\n        "proof": []\n      },\n      {\n        "key": "bTo6OQ==",\n        "value": "eyJwcmVtaXVtIjp0cnVlLCJzZW5kZXIiOiJuZXdsZWRnZXIzLnRlc3RuZXQiLCJ0ZXh0IjoiTGVkZ2VyIn0=",\n        "proof": []\n      },\n      {\n        "key": "bTpsZW4=",\n        "value": "MzQ=",\n        "proof": []\n      }\n    ],\n    "proof": [],\n    "block_height": 17814234,\n    "block_hash": "GT1D8nweVQU1zyCUv399x8vDv2ogVq71w17MyR66hXBB"\n  },\n  "id": "dontcare"\n}\n'))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Note"),": Currently, the response includes a ",(0,r.kt)("inlineCode",{parentName:"p"},"proof")," field directly in the\n",(0,r.kt)("inlineCode",{parentName:"p"},"result"),", and a ",(0,r.kt)("inlineCode",{parentName:"p"},"proof")," fields on each element of the ",(0,r.kt)("inlineCode",{parentName:"p"},"values")," list.  In\nthe future, the ",(0,r.kt)("inlineCode",{parentName:"p"},"result.proof")," will be included only if the result is ",(0,r.kt)("strong",{parentName:"p"},"not empty"),",\nand the ",(0,r.kt)("inlineCode",{parentName:"p"},"proof")," field will be removed from all ",(0,r.kt)("inlineCode",{parentName:"p"},"values"),". When parsing the result, you\nshould accept objects with or without these fields set.")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Heads up")),(0,r.kt)("p",{parentName:"blockquote"},"There is a limitation on default RPC nodes. You won't be able to get the contract state if it is too big. The default limit of for contract state is 50kb of state size. You're able to change the limits if you ",(0,r.kt)("a",{parentName:"p",href:"https://near-nodes.io/validator/compile-and-run-a-node"},"run your own RPC node")," with adjusted ",(0,r.kt)("inlineCode",{parentName:"p"},"trie_viewer_state_size_limit")," value in ",(0,r.kt)("inlineCode",{parentName:"p"},"config.json"))),(0,r.kt)("h4",{id:"what-could-go-wrong-3"},"What Could Go Wrong?"),(0,r.kt)("p",null,"When API request fails, RPC server returns a structured error response with a limited number of well-defined error variants, so client code can exhaustively handle all the possible error cases. Our JSON-RPC errors follow ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/joyent/node-verror"},"verror")," convention for structuring the error response:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "error": {\n        "name": <ERROR_TYPE>,\n        "cause": {\n            "info": {..},\n            "name": <ERROR_CAUSE>\n        },\n        "code": -32000,\n        "data": String,\n        "message": "Server error",\n    },\n    "id": "dontcare",\n    "jsonrpc": "2.0"\n}\n')),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Heads up")),(0,r.kt)("p",{parentName:"blockquote"},"The fields ",(0,r.kt)("inlineCode",{parentName:"p"},"code"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"data"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"message")," in the structure above are considered legacy ones and might be deprecated in the future. Please, don't rely on them.")),(0,r.kt)("p",null,"Here is the exhaustive list of the error variants that can be returned by ",(0,r.kt)("inlineCode",{parentName:"p"},"view_state")," request type:"),(0,r.kt)("table",{class:"custom-stripe"},(0,r.kt)("thead",null,(0,r.kt)("tr",null,(0,r.kt)("th",null,"ERROR_TYPE",(0,r.kt)("br",null),(0,r.kt)("code",null,"error.name")),(0,r.kt)("th",null,"ERROR_CAUSE",(0,r.kt)("br",null),(0,r.kt)("code",null,"error.cause.name")),(0,r.kt)("th",null,"Reason"),(0,r.kt)("th",null,"Solution"))),(0,r.kt)("tbody",null,(0,r.kt)("tr",null,(0,r.kt)("td",{rowspan:"7"},"HANDLER_ERROR"),(0,r.kt)("td",null,"UNKNOWN_BLOCK"),(0,r.kt)("td",null,"The requested block has not been produced yet or it has been garbage-collected (cleaned up to save space on the RPC node)"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Check that the requested block is legit"),(0,r.kt)("li",null,"If the block had been produced more than 5 epochs ago, try to send your request to ",(0,r.kt)("a",{href:"https://near-nodes.io/intro/node-types#archival-node"},"an archival node"))))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"INVALID_ACCOUNT"),(0,r.kt)("td",null,"The requested ",(0,r.kt)("code",null,"account_id")," is invalid"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Provide a valid ",(0,r.kt)("code",null,"account_id"))))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"UNKNOWN_ACCOUNT"),(0,r.kt)("td",null,"The requested ",(0,r.kt)("code",null,"account_id")," has not been found while viewing since the account has not been created or has been already deleted"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Check the ",(0,r.kt)("code",null,"account_id")),(0,r.kt)("li",null,"Specify a different block or retry if you request the latest state")))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"NO_CONTRACT_CODE"),(0,r.kt)("td",null,"The account does not have any ",(0,r.kt)("code",null,"contract")," deployed on it"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Query and account with contract deployed"),(0,r.kt)("li",null,"Specify a different block or retry if you request the latest state")))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"TOO_LARGE_CONTRACT_STATE"),(0,r.kt)("td",null,"The requested contract state is too large to be returned from this node (the default limit is 50kb of state size)"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Send the request to a node with larger limits in order to view the requested state"),(0,r.kt)("li",null,"Spin up your own node where you can increase the limits to view state")))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"UNAVAILABLE_SHARD"),(0,r.kt)("td",null,"The node was unable to find the requested data because it does not track the shard where data is present"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Send a request to a different node which might track the shard")))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"NO_SYNCED_BLOCKS"),(0,r.kt)("td",null,"The node is still syncing and the requested block is not in the database yet"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Wait until the node finish syncing"),(0,r.kt)("li",null,"Send a request to a different node which is synced")))),(0,r.kt)("tr",{class:"stripe"},(0,r.kt)("td",null,"REQUEST_VALIDATION_ERROR"),(0,r.kt)("td",null,"PARSE_ERROR"),(0,r.kt)("td",null,"Passed arguments can't be parsed by JSON RPC server (missing arguments, wrong format, etc.)"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Check the arguments passed and pass the correct ones"),(0,r.kt)("li",null,"Check ",(0,r.kt)("code",null,"error.cause.info")," for more details")))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"INTERNAL_ERROR"),(0,r.kt)("td",null,"INTERNAL_ERROR"),(0,r.kt)("td",null,"Something went wrong with the node itself or overloaded"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Try again later"),(0,r.kt)("li",null,"Send a request to a different node"),(0,r.kt)("li",null,"Check ",(0,r.kt)("code",null,"error.cause.info")," for more details")))))),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"view-contract-state-changes"},"View contract state changes"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Returns the state change details of a contract based on the key prefix (encoded to base64). Pass an empty string for this param if you would like to return all state changes.")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"method: ",(0,r.kt)("inlineCode",{parentName:"li"},"EXPERIMENTAL_changes")),(0,r.kt)("li",{parentName:"ul"},"params:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"changes_type"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"data_changes")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"account_ids"),": ",(0,r.kt)("inlineCode",{parentName:"li"},'["example.testnet"]'),","),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"key_prefix_base64"),": ",(0,r.kt)("inlineCode",{parentName:"li"},'"base64 encoded key value"'),","),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/api/rpc/setup#using-finality-param"},(0,r.kt)("inlineCode",{parentName:"a"},"finality"))," ",(0,r.kt)("em",{parentName:"li"},"OR")," ",(0,r.kt)("a",{parentName:"li",href:"/api/rpc/setup#using-block_id-param"},(0,r.kt)("inlineCode",{parentName:"a"},"block_id")))))),(0,r.kt)("p",null,"Example:"),(0,r.kt)(o.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"json",label:"JSON",default:!0,mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jsonrpc": "2.0",\n  "id": "dontcare",\n  "method": "EXPERIMENTAL_changes",\n  "params": {\n    "changes_type": "data_changes",\n    "account_ids": ["guest-book.testnet"],\n    "key_prefix_base64": "",\n    "block_id": 19450732\n  }\n}\n'))),(0,r.kt)(i.Z,{value:"\ud83c\udf10 JavaScript",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const response = await near.connection.provider.experimental_changes({\n  changes_type: "data_changes",\n  account_ids: ["guest-book.testnet"],\n  key_prefix_base64: "",\n  block_id: 19450732,\n});\n'))),(0,r.kt)(i.Z,{value:"http",label:"HTTPie",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'http post https://rpc.testnet.near.org jsonrpc=2.0 id=dontcare method=EXPERIMENTAL_changes \\\n  params:=\'{\n    "changes_type": "data_changes",\n    "account_ids": ["guest-book.testnet"],\n    "key_prefix_base64": "",\n    "block_id": 19450732\n  }\'\n')))),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Example response: "),(0,r.kt)("p",null,(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jsonrpc": "2.0",\n  "result": {\n    "block_hash": "6U8Yd4JFZwJUNfqkD4KaKgTKmpNSmVRTSggpjmsRWdKY",\n    "changes": [\n      {\n        "cause": {\n          "type": "receipt_processing",\n          "receipt_hash": "9ewznXgs2t7vRCssxW4thgaiwggnMagKybZ7ryLNTT2z"\n        },\n        "type": "data_update",\n        "change": {\n          "account_id": "guest-book.testnet",\n          "key_base64": "bTo6Mzk=",\n          "value_base64": "eyJwcmVtaXVtIjpmYWxzZSwic2VuZGVyIjoiZmhyLnRlc3RuZXQiLCJ0ZXh0IjoiSGkifQ=="\n        }\n      },\n      {\n        "cause": {\n          "type": "receipt_processing",\n          "receipt_hash": "9ewznXgs2t7vRCssxW4thgaiwggnMagKybZ7ryLNTT2z"\n        },\n        "type": "data_update",\n        "change": {\n          "account_id": "guest-book.testnet",\n          "key_base64": "bTpsZW4=",\n          "value_base64": "NDA="\n        }\n      }\n    ]\n  },\n  "id": "dontcare"\n}\n')))),(0,r.kt)("h4",{id:"what-could-go-wrong-4"},"What Could Go Wrong?"),(0,r.kt)("p",null,"When API request fails, RPC server returns a structured error response with a limited number of well-defined error variants, so client code can exhaustively handle all the possible error cases. Our JSON-RPC errors follow ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/joyent/node-verror"},"verror")," convention for structuring the error response:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "error": {\n        "name": <ERROR_TYPE>,\n        "cause": {\n            "info": {..},\n            "name": <ERROR_CAUSE>\n        },\n        "code": -32000,\n        "data": String,\n        "message": "Server error",\n    },\n    "id": "dontcare",\n    "jsonrpc": "2.0"\n}\n')),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Heads up")),(0,r.kt)("p",{parentName:"blockquote"},"The fields ",(0,r.kt)("inlineCode",{parentName:"p"},"code"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"data"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"message")," in the structure above are considered legacy ones and might be deprecated in the future. Please, don't rely on them.")),(0,r.kt)("p",null,"Here is the exhaustive list of the error variants that can be returned by ",(0,r.kt)("inlineCode",{parentName:"p"},"EXPERIMENTAL_changes")," method:"),(0,r.kt)("table",{class:"custom-stripe"},(0,r.kt)("thead",null,(0,r.kt)("tr",null,(0,r.kt)("th",null,"ERROR_TYPE",(0,r.kt)("br",null),(0,r.kt)("code",null,"error.name")),(0,r.kt)("th",null,"ERROR_CAUSE",(0,r.kt)("br",null),(0,r.kt)("code",null,"error.cause.name")),(0,r.kt)("th",null,"Reason"),(0,r.kt)("th",null,"Solution"))),(0,r.kt)("tbody",null,(0,r.kt)("tr",null,(0,r.kt)("td",{rowspan:"2"},"HANDLER_ERROR"),(0,r.kt)("td",null,"UNKNOWN_BLOCK"),(0,r.kt)("td",null,"The requested block has not been produced yet or it has been garbage-collected (cleaned up to save space on the RPC node)"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Check that the requested block is legit"),(0,r.kt)("li",null,"If the block had been produced more than 5 epochs ago, try to send your request to ",(0,r.kt)("a",{href:"https://near-nodes.io/intro/node-types#archival-node"},"an archival node"))))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"NOT_SYNCED_YET"),(0,r.kt)("td",null,"The node is still syncing and the requested block is not in the database yet"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Wait until the node finish syncing"),(0,r.kt)("li",null,"Send a request to a different node which is synced")))),(0,r.kt)("tr",{class:"stripe"},(0,r.kt)("td",null,"REQUEST_VALIDATION_ERROR"),(0,r.kt)("td",null,"PARSE_ERROR"),(0,r.kt)("td",null,"Passed arguments can't be parsed by JSON RPC server (missing arguments, wrong format, etc.)"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Check the arguments passed and pass the correct ones"),(0,r.kt)("li",null,"Check ",(0,r.kt)("code",null,"error.cause.info")," for more details")))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"INTERNAL_ERROR"),(0,r.kt)("td",null,"INTERNAL_ERROR"),(0,r.kt)("td",null,"Something went wrong with the node itself or overloaded"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Try again later"),(0,r.kt)("li",null,"Send a request to a different node"),(0,r.kt)("li",null,"Check ",(0,r.kt)("code",null,"error.cause.info")," for more details")))))),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"view-contract-code-changes"},"View contract code changes"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Returns code changes made when deploying a contract. Change is returned is a base64 encoded WASM file.")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"method: ",(0,r.kt)("inlineCode",{parentName:"li"},"EXPERIMENTAL_changes")),(0,r.kt)("li",{parentName:"ul"},"params:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"changes_type"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"contract_code_changes")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"account_ids"),": ",(0,r.kt)("inlineCode",{parentName:"li"},'["example.testnet"]'),","),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/api/rpc/setup#using-finality-param"},(0,r.kt)("inlineCode",{parentName:"a"},"finality"))," ",(0,r.kt)("em",{parentName:"li"},"OR")," ",(0,r.kt)("a",{parentName:"li",href:"/api/rpc/setup#using-block_id-param"},(0,r.kt)("inlineCode",{parentName:"a"},"block_id")))))),(0,r.kt)("p",null,"Example:"),(0,r.kt)(o.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"json",label:"JSON",default:!0,mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jsonrpc": "2.0",\n  "id": "dontcare",\n  "method": "EXPERIMENTAL_changes",\n  "params": {\n    "changes_type": "contract_code_changes",\n    "account_ids": ["dev-1602714453032-7566969"],\n    "block_id": 20046655\n  }\n}\n'))),(0,r.kt)(i.Z,{value:"\ud83c\udf10 JavaScript",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const response = await near.connection.provider.experimental_changes({\n  changes_type: "contract_code_changes",\n  account_ids: ["dev-1602714453032-7566969"],\n  block_id: 20046655,\n});\n'))),(0,r.kt)(i.Z,{value:"http",label:"HTTPie",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'http post https://rpc.testnet.near.org jsonrpc=2.0 id=dontcare method=EXPERIMENTAL_changes \\\n  params:=\'{\n    "changes_type": "contract_code_changes",\n    "account_ids": ["dev-1602714453032-7566969"],\n    "block_id": 20046655\n  }\'\n')))),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Example response: "),(0,r.kt)("p",null,(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jsonrpc": "2.0",\n  "result": {\n    "block_hash": "3yLNV5zdpzRJ8HP5xTXcF7jdFxuHnmKNUwWcok4616WZ",\n    "changes": [\n      {\n        "cause": {\n          "type": "receipt_processing",\n          "receipt_hash": "CEm3NNaNdu9cijh9NvZMM1srbtEYSsBVwGbZxFQYKt5B"\n        },\n        "type": "contract_code_update",\n        "change": {\n          "account_id": "dev-1602714453032-7566969",\n          "code_base64": "AGFzbQEAAAABpAM3YAF/AGAAAX9gAn9+AGADf35+AGAEf35+fgF+YAZ/fn5+fn4BfmADf35+AX5gAn9+AX5gAn9/AX9gAn9/AGADf39/AX9gAX8BfmACfn4AYAF+AX5gAX4AYAABfmADfn5+AGAAAGAIfn5+fn5+fn4BfmAJfn5+fn5+fn5+AX5gAn5+AX5gA35+fgF+YAd+fn5+fn5+AGAEfn5+fgBgCX5+fn5+fn5+fgBgBX5+fn5+AX5gA39/fwBgAX8Bf2ACf3wAYAR/f39+AGAFf39/fn8AYAV/f39/fwBgBH9/f38AYAN/f38BfmADf39+AGACf38BfmAFf39/f38Bf2AEf39/fwF/YAZ/f39/f38AYAV/f35/fwBgBH9+f38Bf2ACf34Bf2AHf35+f39+fwBgBX9/f39+AGAEf35+fgBgCX9+fn5+fn5+fgF+YAp/fn5+fn5+fn5+AX5gCH9+fn5+fn5+AGAFf35+fn4AYAp/fn5+fn5+fn5+AGAHf39/f39/fwBgBH98f38Bf2AGf39/f39..."\n        }\n      }\n    ]\n  },\n  "id": "dontcare"\n}\n')))),(0,r.kt)("h4",{id:"what-could-go-wrong-5"},"What Could Go Wrong?"),(0,r.kt)("p",null,"When API request fails, RPC server returns a structured error response with a limited number of well-defined error variants, so client code can exhaustively handle all the possible error cases. Our JSON-RPC errors follow ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/joyent/node-verror"},"verror")," convention for structuring the error response:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "error": {\n        "name": <ERROR_TYPE>,\n        "cause": {\n            "info": {..},\n            "name": <ERROR_CAUSE>\n        },\n        "code": -32000,\n        "data": String,\n        "message": "Server error",\n    },\n    "id": "dontcare",\n    "jsonrpc": "2.0"\n}\n')),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Heads up")),(0,r.kt)("p",{parentName:"blockquote"},"The fields ",(0,r.kt)("inlineCode",{parentName:"p"},"code"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"data"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"message")," in the structure above are considered legacy ones and might be deprecated in the future. Please, don't rely on them.")),(0,r.kt)("p",null,"Here is the exhaustive list of the error variants that can be returned by ",(0,r.kt)("inlineCode",{parentName:"p"},"EXPERIMENTAL_changes")," method:"),(0,r.kt)("table",{class:"custom-stripe"},(0,r.kt)("thead",null,(0,r.kt)("tr",null,(0,r.kt)("th",null,"ERROR_TYPE",(0,r.kt)("br",null),(0,r.kt)("code",null,"error.name")),(0,r.kt)("th",null,"ERROR_CAUSE",(0,r.kt)("br",null),(0,r.kt)("code",null,"error.cause.name")),(0,r.kt)("th",null,"Reason"),(0,r.kt)("th",null,"Solution"))),(0,r.kt)("tbody",null,(0,r.kt)("tr",null,(0,r.kt)("td",{rowspan:"2"},"HANDLER_ERROR"),(0,r.kt)("td",null,"UNKNOWN_BLOCK"),(0,r.kt)("td",null,"The requested block has not been produced yet or it has been garbage-collected (cleaned up to save space on the RPC node)"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Check that the requested block is legit"),(0,r.kt)("li",null,"If the block had been produced more than 5 epochs ago, try to send your request to ",(0,r.kt)("a",{href:"https://near-nodes.io/intro/node-types#archival-node"},"an archival node"))))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"NOT_SYNCED_YET"),(0,r.kt)("td",null,"The node is still syncing and the requested block is not in the database yet"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Wait until the node finish syncing"),(0,r.kt)("li",null,"Send a request to a different node which is synced")))),(0,r.kt)("tr",{class:"stripe"},(0,r.kt)("td",null,"REQUEST_VALIDATION_ERROR"),(0,r.kt)("td",null,"PARSE_ERROR"),(0,r.kt)("td",null,"Passed arguments can't be parsed by JSON RPC server (missing arguments, wrong format, etc.)"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Check the arguments passed and pass the correct ones"),(0,r.kt)("li",null,"Check ",(0,r.kt)("code",null,"error.cause.info")," for more details")))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"INTERNAL_ERROR"),(0,r.kt)("td",null,"INTERNAL_ERROR"),(0,r.kt)("td",null,"Something went wrong with the node itself or overloaded"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Try again later"),(0,r.kt)("li",null,"Send a request to a different node"),(0,r.kt)("li",null,"Check ",(0,r.kt)("code",null,"error.cause.info")," for more details")))))),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"call-a-contract-function"},"Call a contract function"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Allows you to call a contract method as a ",(0,r.kt)("a",{parentName:"p",href:"/tools/near-cli#near-view-near-view"},"view function"),".")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"method: ",(0,r.kt)("inlineCode",{parentName:"li"},"query")),(0,r.kt)("li",{parentName:"ul"},"params:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"request_type"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"call_function")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/api/rpc/setup#using-finality-param"},(0,r.kt)("inlineCode",{parentName:"a"},"finality"))," ",(0,r.kt)("em",{parentName:"li"},"OR")," ",(0,r.kt)("a",{parentName:"li",href:"/api/rpc/setup#using-block_id-param"},(0,r.kt)("inlineCode",{parentName:"a"},"block_id"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"account_id"),": ",(0,r.kt)("em",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"em"},'"example.testnet"'))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"method_name"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"name_of_a_example.testnet_method")," (example ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/near/core-contracts/blob/master/staking-pool/src/lib.rs#L317"},(0,r.kt)("inlineCode",{parentName:"a"},"view")," methods")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"args_base64"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"method_arguments_base_64_encoded"))))),(0,r.kt)("p",null,"Example (",(0,r.kt)("inlineCode",{parentName:"p"},"get_num"),"):"),(0,r.kt)(o.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"json",label:"JSON",default:!0,mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jsonrpc": "2.0",\n  "id": "dontcare",\n  "method": "query",\n  "params": {\n    "request_type": "call_function",\n    "finality": "final",\n    "account_id": "dev-1588039999690",\n    "method_name": "get_num",\n    "args_base64": "e30="\n  }\n}\n'))),(0,r.kt)(i.Z,{value:"\ud83c\udf10 JavaScript",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const response = await near.connection.provider.query({\n  request_type: "call_function",\n  finality: "final",\n  account_id: "dev-1588039999690",\n  method_name: "get_num",\n  args_base64: "e30=",\n});\n'))),(0,r.kt)(i.Z,{value:"http",label:"HTTPie",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'http post https://rpc.testnet.near.org jsonrpc=2.0 id=dontcare method=query \\\n  params:=\'{\n    "request_type": "call_function",\n    "finality": "final",\n    "account_id": "dev-1588039999690",\n    "method_name": "get_num",\n    "args_base64": "e30="\n  }\'\n')))),(0,r.kt)("p",null,"Example (",(0,r.kt)("inlineCode",{parentName:"p"},"get_account_staked_balance"),"):"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"args_base64")," in this example is decoded as ",(0,r.kt)("inlineCode",{parentName:"p"},'{"account_id":"dev-1588039999690"}'),".  The ",(0,r.kt)("inlineCode",{parentName:"p"},"account_id")," would likely be the validator and not the same account for this particular view function."),(0,r.kt)(o.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"json",label:"JSON",default:!0,mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jsonrpc": "2.0",\n  "id": "dontcare",\n  "method": "query",\n  "params": {\n    "request_type": "call_function",\n    "finality": "final",\n    "account_id": "dev-1588039999690",\n    "method_name": "get_account_staked_balance",\n    "args_base64": "eyJhY2NvdW50X2lkIjoiZGV2LTE1ODgwMzk5OTk2OTAifQ=="\n  }\n}\n'))),(0,r.kt)(i.Z,{value:"\ud83c\udf10 JavaScript",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const response = await near.connection.provider.query({\n  request_type: "call_function",\n  finality: "final",\n  account_id: "dev-1588039999690",\n  method_name: "get_account_staked_balance",\n  args_base64: "eyJhY2NvdW50X2lkIjoiZGV2LTE1ODgwMzk5OTk2OTAifQ==",\n});\n'))),(0,r.kt)(i.Z,{value:"http",label:"HTTPie",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'http post https://rpc.testnet.near.org jsonrpc=2.0 id=dontcare method=query \\\n  params:=\'{\n    "request_type": "call_function",\n    "finality": "final",\n    "account_id": "dev-1588039999690",\n    "method_name": "get_account_staked_balance",\n    "args_base64": "eyJhY2NvdW50X2lkIjoiZGV2LTE1ODgwMzk5OTk2OTAifQ=="\n  }\'\n')))),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Example response: "),(0,r.kt)("p",null,(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jsonrpc": "2.0",\n  "result": {\n    "result": [48],\n    "logs": [],\n    "block_height": 17817336,\n    "block_hash": "4qkA4sUUG8opjH5Q9bL5mWJTnfR4ech879Db1BZXbx6P"\n  },\n  "id": "dontcare"\n}\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Note"),": ",(0,r.kt)("inlineCode",{parentName:"p"},"[48]")," is an array of bytes, to be specific it is an ASCII code of ",(0,r.kt)("inlineCode",{parentName:"p"},"0"),".",(0,r.kt)("inlineCode",{parentName:"p"},"near-sdk-rs")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"near-sdk-js")," return JSON-serialized results."))),(0,r.kt)("h4",{id:"what-could-go-wrong-6"},"What Could Go Wrong?"),(0,r.kt)("p",null,"When API request fails, RPC server returns a structured error response with a limited number of well-defined error variants, so client code can exhaustively handle all the possible error cases. Our JSON-RPC errors follow ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/joyent/node-verror"},"verror")," convention for structuring the error response:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "error": {\n        "name": <ERROR_TYPE>,\n        "cause": {\n            "info": {..},\n            "name": <ERROR_CAUSE>\n        },\n        "code": -32000,\n        "data": String,\n        "message": "Server error",\n    },\n    "id": "dontcare",\n    "jsonrpc": "2.0"\n}\n')),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Heads up")),(0,r.kt)("p",{parentName:"blockquote"},"The fields ",(0,r.kt)("inlineCode",{parentName:"p"},"code"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"data"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"message")," in the structure above are considered legacy ones and might be deprecated in the future. Please, don't rely on them.")),(0,r.kt)("p",null,"Here is the exhaustive list of the error variants that can be returned by ",(0,r.kt)("inlineCode",{parentName:"p"},"call_function")," request type:"),(0,r.kt)("table",{class:"custom-stripe"},(0,r.kt)("thead",null,(0,r.kt)("tr",null,(0,r.kt)("th",null,"ERROR_TYPE",(0,r.kt)("br",null),(0,r.kt)("code",null,"error.name")),(0,r.kt)("th",null,"ERROR_CAUSE",(0,r.kt)("br",null),(0,r.kt)("code",null,"error.cause.name")),(0,r.kt)("th",null,"Reason"),(0,r.kt)("th",null,"Solution"))),(0,r.kt)("tbody",null,(0,r.kt)("tr",null,(0,r.kt)("td",{rowspan:"7"},"HANDLER_ERROR"),(0,r.kt)("td",null,"UNKNOWN_BLOCK"),(0,r.kt)("td",null,"The requested block has not been produced yet or it has been garbage-collected (cleaned up to save space on the RPC node)"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Check that the requested block is legit"),(0,r.kt)("li",null,"If the block had been produced more than 5 epochs ago, try to send your request to ",(0,r.kt)("a",{href:"https://near-nodes.io/intro/node-types#archival-node"},"an archival node"))))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"INVALID_ACCOUNT"),(0,r.kt)("td",null,"The requested ",(0,r.kt)("code",null,"account_id")," is invalid"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Provide a valid ",(0,r.kt)("code",null,"account_id"))))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"UNKNOWN_ACCOUNT"),(0,r.kt)("td",null,"The requested ",(0,r.kt)("code",null,"account_id")," has not been found while viewing since the account has not been created or has been already deleted"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Check the ",(0,r.kt)("code",null,"account_id")),(0,r.kt)("li",null,"Specify a different block or retry if you request the latest state")))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"NO_CONTRACT_CODE"),(0,r.kt)("td",null,"The requested ",(0,r.kt)("code",null,"contract_code")," has not been found while viewing"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Check the ",(0,r.kt)("code",null,"public_key")),(0,r.kt)("li",null,"Specify a different block or retry if you request the latest state")))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"CONTRACT_EXECUTION_ERROR"),(0,r.kt)("td",null,"The execution of the view method call failed (crashed, run out of the default 200 TGas limit, etc)"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Check ",(0,r.kt)("code",null,"error.cause.info")," for more details")))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"UNAVAILABLE_SHARD"),(0,r.kt)("td",null,"The node was unable to find the requested data because it does not track the shard where data is present"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Send a request to a different node which might track the shard")))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"NO_SYNCED_BLOCKS"),(0,r.kt)("td",null,"The node is still syncing and the requested block is not in the database yet"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Wait until the node finish syncing"),(0,r.kt)("li",null,"Send a request to a different node which is synced")))),(0,r.kt)("tr",{class:"stripe"},(0,r.kt)("td",null,"REQUEST_VALIDATION_ERROR"),(0,r.kt)("td",null,"PARSE_ERROR"),(0,r.kt)("td",null,"Passed arguments can't be parsed by JSON RPC server (missing arguments, wrong format, etc.)"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Check the arguments passed and pass the correct ones"),(0,r.kt)("li",null,"Check ",(0,r.kt)("code",null,"error.cause.info")," for more details")))),(0,r.kt)("tr",null,(0,r.kt)("td",null,"INTERNAL_ERROR"),(0,r.kt)("td",null,"INTERNAL_ERROR"),(0,r.kt)("td",null,"Something went wrong with the node itself or overloaded"),(0,r.kt)("td",null,(0,r.kt)("ul",null,(0,r.kt)("li",null,"Try again later"),(0,r.kt)("li",null,"Send a request to a different node"),(0,r.kt)("li",null,"Check ",(0,r.kt)("code",null,"error.cause.info")," for more details")))))),(0,r.kt)("hr",null))}h.isMDXComponent=!0}}]);